<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£ä¹¦é—¯å…³ï¼šä¸€é©¬å¹³å·</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ä¿®å¤éƒ¨åˆ†ç§»åŠ¨ç«¯æ»šåŠ¨è¡Œä¸º */
        body { margin: 0; padding: 0; overflow-x: hidden; touch-action: manipulation; }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡éšè— (å¯é€‰) */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body class="bg-red-50 text-gray-900 font-sans antialiased selection:bg-red-200 selection:text-red-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. è·å–å…¨å±€å˜é‡ (æ›¿ä»£ import) ---
        const { useState, useEffect } = React;

        // --- 2. å†…ç½®å›¾æ ‡ç»„ä»¶ (æ›¿ä»£ lucide-react å¤–éƒ¨ä¾èµ–ï¼Œä¿®å¤æŠ¥é”™) ---
        const IconBase = ({ size = 24, className = "", children, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Trophy = (props) => (
            <IconBase {...props}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M10 14.66V17" />
                <path d="M14 14.66V17" />
                <path d="M17 19v3" />
                <path d="M7 19v3" />
                <path d="M10 22h4" />
                <path d="M8.21 13.89L7 23" />
                <path d="M15.79 13.89L17 23" />
            </IconBase>
        );

        const Lock = (props) => (
            <IconBase {...props}>
                <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </IconBase>
        );

        const Flag = (props) => (
            <IconBase {...props}>
                <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" />
                <line x1="4" x2="4" y1="22" y2="15" />
            </IconBase>
        );

        const MapPin = (props) => (
            <IconBase {...props}>
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                <circle cx="12" cy="10" r="3" />
            </IconBase>
        );

        const CheckCircle = (props) => (
            <IconBase {...props}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </IconBase>
        );

        const XCircle = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <path d="m15 9-6 6" />
                <path d="m9 9 6 6" />
            </IconBase>
        );

        const Clock = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
            </IconBase>
        );

        const Star = (props) => (
            <IconBase {...props}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
            </IconBase>
        );

        /**
         * é£ä¹¦é—¯å…³ï¼šä¸€é©¬å¹³å· - æ¸¸æˆæ•°æ®
         */
        const GameData = [
          {
            id: 1,
            city: "ä¸€é©¬å½“å…ˆ",
            type: "single",
            question: "æˆ‘å¯ä»¥å°†è‡ªå·±ç½®é¡¶ï¼Œæ–¹ä¾¿æ”¶é›†å’Œä¼ è¾“å„ç±»ä¿¡æ¯ã€æ–‡æ¡£æ­£ç¡®ã€‚",
            options: [
              { id: "A", text: "æ­£ç¡®" },
              { id: "B", text: "é”™è¯¯" }
            ],
            correctAnswer: ["A"],
            explanation: "Aæ­£ç¡®"
          },
          {
            id: 2,
            city: "é²œè¡£æ€’é©¬",
            type: "single",
            question: "è®¾ç½®äº‘æ–‡æ¡£æƒé™æ—¶ï¼Œæ·»åŠ å…¶ä»–åŒäº‹ä¸ºåä½œè€…ï¼Œéƒ½ä¸€å®šä¼šå‘é€é€šçŸ¥ï¼Œæ— æ³•è®¾ç½®æˆä¸é€šçŸ¥ã€‚",
            options: [
              { id: "A", text: "æ­£ç¡®" },
              { id: "B", text: "é”™è¯¯" }
            ],
            correctAnswer: ["B"],
            explanation: "Bé”™è¯¯ (å¯ä»¥åœ¨åˆ†äº«æ—¶é€‰æ‹©ä¸å‘é€é€šçŸ¥)"
          },
          {
            id: 3,
            city: "å¿«é©¬åŠ é­",
            type: "single",
            question: "é£ä¹¦æ–‡æ¡£å’Œé£ä¹¦è¡¨æ ¼ä¸­æ’å…¥çš„å¤šç»´è¡¨æ ¼ä¹Ÿå¯ä»¥è®¾ç½®é«˜çº§æƒé™é”™è¯¯ã€‚",
            options: [
              { id: "A", text: "æ­£ç¡®" },
              { id: "B", text: "é”™è¯¯" }
            ],
            correctAnswer: ["B"],
            explanation: "Bé”™è¯¯ (å®é™…ä¸Šæ˜¯å¯ä»¥è®¾ç½®é«˜çº§æƒé™çš„)"
          },
          {
            id: 4,
            city: "é©¬ä¸åœè¹„",
            type: "multiple",
            question: "ä½œä¸ºä¼šè®®çš„ä¸»æŒäººï¼Œæˆ‘åº”è¯¥åšåˆ°ä»¥ä¸‹å“ªäº›ï¼Ÿ",
            options: [
              { id: "A", text: "ä¼šè®®æ—¶é—´å®‰æ’ç´§å‡‘æ—¶ï¼Œé€šè¿‡ä¼šè®®å€’è®¡æ—¶æ§åˆ¶å‘è¨€æ—¶é—´" },
              { id: "B", text: "åŠæ—¶å¼€å§‹å¦™è®°è®°å½•ï¼Œä¼šé—´ä¼‘æ¯æ—¶å…³é—­å¦™è®°è®°å½•" },
              { id: "C", text: "å½“æˆ‘éœ€è¦æ“ä½œå…±äº«å±å¹•å’Œå…±äº«æ–‡æ¡£æ—¶ï¼Œé€šè¿‡ä¿®æ”¹ä¸ªäººçŠ¶æ€å…³é—­é£ä¹¦æ¶ˆæ¯æé†’" },
              { id: "D", text: "å½“å‘ç°æœ‰åŒäº‹å¿˜è®°å…³éº¦æ—¶ï¼Œé€šè¿‡å…¨å‘˜é™éŸ³æŒ‰é’®ç»´æŒä¼šè®®ç§©åº" }
            ],
            correctAnswer: ["A", "B", "C", "D"],
            explanation: "ABCDéƒ½æ˜¯ä¼šè®®ä¸»æŒäººçš„ä¼˜ç§€å®è·µã€‚"
          },
          {
            id: 5,
            city: "é©¬åˆ°æˆåŠŸ",
            type: "multiple",
            question: "é€šè¿‡å¤šç»´è¡¨æ ¼çš„è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œå¯å®ç°çš„çš„åœºæ™¯æœ‰ï¼Ÿ",
            options: [
              { id: "A", text: "åœ¨ä»»åŠ¡æˆªæ­¢å‰ 1 å¤©ï¼Œè‡ªåŠ¨æé†’æœªå®Œæˆä»»åŠ¡çš„è´Ÿè´£äºº" },
              { id: "B", text: "æ–°å¢ä¸€æ¡ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å°†ä»»åŠ¡çŠ¶æ€æ ‡ä¸ºæœªå¼€å§‹" },
              { id: "C", text: "æ¯å‘¨ä¸€æ—©ä¸Š 10 ç‚¹æé†’æ‰€æœ‰å›¢é˜Ÿæˆå‘˜æ›´æ–°å‘¨æŠ¥" },
              { id: "D", text: "éœ€æ±‚çŠ¶æ€å˜æ›´ä¸ºå¾…éªŒæ”¶æ—¶ï¼Œè‡ªåŠ¨é€šçŸ¥éªŒæ”¶è´Ÿè´£äºº" }
            ],
            correctAnswer: ["A", "B", "C", "D"],
            explanation: "å¤šç»´è¡¨æ ¼è‡ªåŠ¨åŒ–éå¸¸å¼ºå¤§ï¼Œä»¥ä¸Šåœºæ™¯å‡å¯å®ç°ã€‚"
          }
        ];

        // --- å­ç»„ä»¶ ---

        const Confetti = () => {
          return (
            <div className="fixed inset-0 pointer-events-none overflow-hidden z-50 flex justify-center">
              {[...Array(30)].map((_, i) => (
                <div
                  key={i}
                  className="absolute animate-fall opacity-0"
                  style={{
                    left: `${Math.random() * 100}%`,
                    top: `-5%`,
                    animationDelay: `${Math.random() * 2}s`,
                    animationDuration: `${2.5 + Math.random() * 3}s`,
                    backgroundColor: ['#ff5722', '#ffc107', '#4caf50', '#2196f3', '#e91e63'][Math.floor(Math.random() * 5)],
                    width: `${8 + Math.random() * 6}px`,
                    height: `${8 + Math.random() * 6}px`,
                    borderRadius: Math.random() > 0.5 ? '50%' : '2px',
                    transform: `rotate(${Math.random() * 360}deg)`
                  }}
                />
              ))}
            </div>
          );
        };

        // --- ä¸»ç»„ä»¶ ---
        function App() {
          const [currentScreen, setCurrentScreen] = useState('welcome');
          const [unlockedLevel, setUnlockedLevel] = useState(0); 
          const [activeLevelId, setActiveLevelId] = useState(null);
          
          const [selectedOptions, setSelectedOptions] = useState([]);
          const [showFeedback, setShowFeedback] = useState(false);
          const [isCorrect, setIsCorrect] = useState(false);

          const [startTime, setStartTime] = useState(null);
          const [endTime, setEndTime] = useState(null);

          // --- é€»è¾‘å¤„ç† ---

          const startGame = () => {
            setStartTime(Date.now());
            setCurrentScreen('map');
          };

          const enterLevel = (levelIndex) => {
            // ç¦æ­¢è¿›å…¥æœªè§£é”å…³å¡
            if (levelIndex > unlockedLevel) return;
            
            // å…è®¸å¤ä¹ æˆ–è¿›å…¥å½“å‰å…³å¡
            setActiveLevelId(levelIndex);
            setSelectedOptions([]);
            setShowFeedback(false);
            setCurrentScreen('quiz');
          };

          const handleOptionSelect = (optionId, type) => {
            if (showFeedback) return;

            if (type === 'single') {
              setSelectedOptions([optionId]);
            } else {
              if (selectedOptions.includes(optionId)) {
                setSelectedOptions(selectedOptions.filter(id => id !== optionId));
              } else {
                setSelectedOptions([...selectedOptions, optionId]);
              }
            }
          };

          const submitAnswer = () => {
            const currentQuestion = GameData[activeLevelId];
            
            const userAns = [...selectedOptions].sort();
            const correctAns = [...currentQuestion.correctAnswer].sort();
            
            const correct = JSON.stringify(userAns) === JSON.stringify(correctAns);
            
            setIsCorrect(correct);
            setShowFeedback(true);
          };

          const backToMapAfterSuccess = () => {
             // å¦‚æœæ˜¯æœ€åä¸€å…³
             if (activeLevelId === GameData.length - 1) {
                setEndTime(Date.now());
                setUnlockedLevel(prev => prev + 1); // å…¨é€šå…³
                setCurrentScreen('result');
             } else {
                // è§£é”ä¸‹ä¸€å…³
                setUnlockedLevel(prev => Math.max(prev, activeLevelId + 1));
                setCurrentScreen('map');
             }
          };

          const getDuration = () => {
            if (!startTime || !endTime) return "0ç§’";
            const diff = Math.floor((endTime - startTime) / 1000);
            const m = Math.floor(diff / 60);
            const s = diff % 60;
            return m > 0 ? `${m}åˆ†${s}ç§’` : `${s}ç§’`;
          };

          // --- æ¸²æŸ“è§†å›¾ ---

          const renderWelcome = () => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-red-600 to-red-800 p-6 text-white text-center relative overflow-hidden">
              {/* èƒŒæ™¯è£…é¥° */}
              <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none" 
                   style={{backgroundImage: 'radial-gradient(circle, #fff 2px, transparent 2px)', backgroundSize: '30px 30px'}}>
              </div>

              <div className="w-24 h-24 bg-yellow-400 rounded-full flex items-center justify-center mb-6 shadow-xl animate-bounce relative z-10 border-4 border-yellow-200">
                  <Trophy size={48} className="text-red-700" />
              </div>
              <h1 className="text-4xl font-bold mb-4 tracking-wider drop-shadow-md">é£ä¹¦é—¯å…³</h1>
              <h2 className="text-2xl font-light mb-8 opacity-90 border-b border-red-400 pb-2">ä¸€é©¬å½“å…ˆ Â· æ•ˆç‡å€å¢</h2>
              
              <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-8 max-w-xs w-full">
                <p className="text-sm font-medium">âœ¨ æŒ‘æˆ˜ä»»åŠ¡ âœ¨</p>
                <p className="text-xs opacity-80 mt-2">å®Œæˆ5ä¸ªåŸå¸‚æŒ‘æˆ˜ï¼Œèµ¢å–æ–°å¹´ä¸“å±å°å·ï¼</p>
              </div>
              
              <button 
                onClick={startGame}
                className="px-8 py-4 bg-gradient-to-r from-yellow-400 to-yellow-500 text-red-900 font-bold rounded-full text-xl shadow-lg transform transition-all active:scale-95 hover:shadow-xl hover:-translate-y-1 w-full max-w-xs border-b-4 border-yellow-600"
              >
                å¼€å§‹æŒ‘æˆ˜
              </button>
            </div>
          );

          const renderMap = () => (
            <div className="min-h-screen bg-red-50 pb-10">
              <div className="bg-gradient-to-r from-red-600 to-red-700 p-6 pt-10 text-white shadow-lg rounded-b-[2.5rem] mb-10 relative">
                 <h2 className="text-3xl font-bold text-center">é—¯å…³åœ°å›¾</h2>
                 <p className="text-center text-sm opacity-80 mt-2">ç‚¹å‡»ç‚¹äº®çš„åŸå¸‚å¼€å§‹ç­”é¢˜</p>
                 <div className="absolute bottom-[-20px] left-1/2 transform -translate-x-1/2 bg-yellow-400 text-red-800 text-xs font-bold px-4 py-1 rounded-full shadow-md">
                    å½“å‰è¿›åº¦: {Math.min(unlockedLevel, 5)} / 5
                 </div>
              </div>

              <div className="max-w-md mx-auto px-6 relative">
                {/* è¿æ¥çº¿èƒŒæ™¯ */}
                <div className="absolute left-8 top-4 bottom-20 w-1 bg-gray-200 z-0 rounded-full"></div>
                {/* è¿›åº¦è¿æ¥çº¿ */}
                <div 
                  className="absolute left-8 top-4 w-1 bg-yellow-500 transition-all duration-1000 z-0 rounded-full"
                  style={{ height: `${Math.min((unlockedLevel / 4) * 85, 85)}%` }} // ç®€å•ä¼°ç®—é«˜åº¦æ¯”ä¾‹
                ></div>

                <div className="flex flex-col gap-6 relative z-10 pl-2">
                  {GameData.map((level, index) => {
                    const isLocked = index > unlockedLevel;
                    const isCompleted = index < unlockedLevel;
                    const isCurrent = index === unlockedLevel;

                    return (
                      <div 
                        key={level.id} 
                        onClick={() => enterLevel(index)}
                        className={`
                          relative flex items-center p-4 rounded-xl shadow-sm border-2 transition-all duration-300 ml-6
                          ${isLocked ? 'bg-gray-50 border-gray-100 cursor-not-allowed grayscale opacity-60' : 
                            isCompleted ? 'bg-white border-green-200 cursor-pointer hover:bg-green-50' : 
                            'bg-white border-yellow-400 cursor-pointer transform hover:-translate-y-1 shadow-md ring-4 ring-yellow-100/50'}
                        `}
                      >
                        {/* å·¦ä¾§è¿æ¥ç‚¹è£…é¥° */}
                         <div className={`absolute -left-[30px] top-1/2 transform -translate-y-1/2 w-4 h-4 rounded-full border-2 z-20 
                            ${isLocked ? 'bg-gray-300 border-white' : 'bg-yellow-500 border-white shadow-sm'}`}>
                         </div>

                        {/* çŠ¶æ€å›¾æ ‡ */}
                        <div className={`
                          w-12 h-12 rounded-full flex items-center justify-center mr-4 shrink-0 transition-colors
                          ${isLocked ? 'bg-gray-200 text-gray-400' : isCompleted ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'}
                        `}>
                          {isLocked && <Lock size={20} />}
                          {isCompleted && <Flag size={20} fill="currentColor" />}
                          {isCurrent && <MapPin size={24} className="animate-pulse" fill="currentColor" />}
                        </div>

                        {/* æ–‡æœ¬å†…å®¹ */}
                        <div className="flex-1">
                          <h3 className={`font-bold text-lg ${isLocked ? 'text-gray-400' : 'text-gray-800'}`}>
                            ç¬¬{index + 1}å…³ï¼š{level.city}
                          </h3>
                          <div className="text-xs text-gray-500 mt-1 flex items-center">
                            {isCompleted ? <span className="text-green-600 font-medium flex items-center"><CheckCircle size={12} className="mr-1"/> å·²æ’æ——å é¢†</span> : 
                             isLocked ? <span>å¾…è§£é”</span> : 
                             <span className="text-yellow-600 font-bold bg-yellow-50 px-2 py-0.5 rounded-full">ç‚¹å‡»æŒ‘æˆ˜!</span>}
                          </div>
                        </div>

                        {/* å½“å‰å…³å¡æŒ‡ç¤ºå™¨ */}
                        {isCurrent && (
                            <div className="absolute -right-2 -top-2">
                              <span className="relative flex h-4 w-4">
                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                <span className="relative inline-flex rounded-full h-4 w-4 bg-red-500"></span>
                              </span>
                            </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          );

          const renderQuiz = () => {
            const question = GameData[activeLevelId];

            return (
              <div className="min-h-screen bg-gray-50 flex flex-col">
                {/* é¡¶éƒ¨å¯¼èˆª */}
                <div className="bg-white px-4 py-3 shadow-sm flex items-center justify-between sticky top-0 z-20">
                  <button onClick={() => setCurrentScreen('map')} className="text-gray-500 text-sm hover:text-gray-800 flex items-center px-2 py-1 rounded hover:bg-gray-100">
                      â† è¿”å›åœ°å›¾
                  </button>
                  <div className="font-bold text-gray-800 flex flex-col items-center">
                      <span className="text-xs text-gray-400">å½“å‰æŒ‘æˆ˜</span>
                      <span>{question.city}</span>
                  </div>
                  <div className="text-xs font-mono text-gray-400 bg-gray-100 px-2 py-1 rounded">
                    {activeLevelId + 1}/{GameData.length}
                  </div>
                </div>

                {/* é¢˜ç›®å†…å®¹ */}
                <div className="flex-1 p-4 max-w-md mx-auto w-full pb-24">
                  <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
                      <div className="mb-4 flex items-center justify-between">
                        <span className={`text-xs font-bold px-2 py-1 rounded-md ${question.type === 'single' ? 'bg-blue-100 text-blue-600' : 'bg-purple-100 text-purple-600'}`}>
                          {question.type === 'single' ? 'å•é€‰é¢˜' : 'å¤šé€‰é¢˜'}
                        </span>
                        {/* è¿›åº¦æ¡ */}
                        <div className="w-24 h-1.5 bg-gray-100 rounded-full overflow-hidden">
                             <div className="h-full bg-blue-500 transition-all duration-300" style={{width: `${((activeLevelId + 1) / GameData.length) * 100}%`}}></div>
                        </div>
                      </div>
                      <h2 className="text-lg font-bold text-gray-800 leading-relaxed">
                        {question.question}
                      </h2>
                  </div>

                  <div className="space-y-3">
                    {question.options.map(opt => {
                      const isSelected = selectedOptions.includes(opt.id);
                      return (
                        <button
                          key={opt.id}
                          onClick={() => handleOptionSelect(opt.id, question.type)}
                          disabled={showFeedback}
                          className={`
                            w-full text-left p-4 rounded-xl border-2 transition-all flex items-start group
                            ${isSelected 
                              ? 'border-blue-500 bg-blue-50 text-blue-900 shadow-md' 
                              : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50 hover:border-gray-300'}
                            ${showFeedback ? 'opacity-90 cursor-default' : 'cursor-pointer active:scale-[0.99]'}
                          `}
                        >
                          <div className={`
                            w-6 h-6 rounded-full border-2 flex items-center justify-center mr-3 mt-0.5 shrink-0 transition-colors
                            ${isSelected ? 'border-blue-500 bg-blue-500 text-white' : 'border-gray-300 group-hover:border-gray-400'}
                          `}>
                            {isSelected && <div className="w-2 h-2 bg-white rounded-full"></div>}
                          </div>
                          <span className="leading-relaxed"><span className="font-bold mr-1 opacity-50">{opt.id}.</span> {opt.text}</span>
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* åº•éƒ¨æ“ä½œæ  */}
                <div className="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-30">
                    <div className="max-w-md mx-auto">
                      {!showFeedback ? (
                        <button 
                          onClick={submitAnswer}
                          disabled={selectedOptions.length === 0}
                          className={`w-full py-3.5 rounded-xl font-bold text-lg text-center transition-all
                            ${selectedOptions.length === 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200 active:scale-[0.98]'}
                          `}
                        >
                          æäº¤ç­”æ¡ˆ
                        </button>
                      ) : (
                        // ç»“æœåé¦ˆ
                        <div className={`rounded-xl p-4 animate-fade-in-up ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}>
                           <div className="flex items-center mb-2">
                             {isCorrect ? <CheckCircle className="text-green-600 mr-2 flex-shrink-0" /> : <XCircle className="text-red-600 mr-2 flex-shrink-0" />}
                             <span className={`font-bold text-lg ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>
                               {isCorrect ? `å›ç­”æ­£ç¡®ï¼` : "å›ç­”é”™è¯¯"}
                             </span>
                           </div>
                           <p className="text-sm text-gray-700 mb-4 pl-8 leading-relaxed">
                              {!isCorrect && <span className="block font-bold mb-1 text-red-800">æ­£ç¡®ç­”æ¡ˆï¼š{question.correctAnswer.join('')}</span>}
                              {question.explanation}
                           </p>
                           
                           {isCorrect ? (
                             <button onClick={backToMapAfterSuccess} className="w-full py-3 bg-green-600 text-white rounded-lg font-bold shadow-md hover:bg-green-700 active:scale-[0.98] transition-transform flex items-center justify-center">
                               {activeLevelId === 4 ? "é¢†å–å¥–åŠ±" : "ä¸‹ä¸€å…³"} <span className="ml-1">â†’</span>
                             </button>
                           ) : (
                             <button onClick={() => { setShowFeedback(false); setSelectedOptions([]); }} className="w-full py-3 bg-white border border-red-200 text-red-600 rounded-lg font-bold hover:bg-red-50 transition-colors">
                               å†è¯•ä¸€æ¬¡
                             </button>
                           )}
                        </div>
                      )}
                    </div>
                </div>
              </div>
            );
          };

          const renderResult = () => (
            <div className="min-h-screen bg-gradient-to-br from-yellow-500 to-red-600 flex flex-col items-center justify-center p-6 text-center relative overflow-hidden">
              <Confetti />
              
              <div className="bg-white/95 backdrop-blur-md p-8 rounded-[2rem] shadow-2xl max-w-sm w-full relative z-10 animate-fade-in-up border-4 border-yellow-200">
                <div className="absolute -top-12 left-1/2 transform -translate-x-1/2">
                    <div className="w-24 h-24 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded-full border-4 border-white flex items-center justify-center shadow-lg">
                       <Star size={48} className="text-white fill-current animate-pulse" />
                    </div>
                </div>
                
                <div className="mt-10">
                  <h2 className="text-red-500 text-sm uppercase tracking-[0.2em] font-bold mb-2">CERTIFICATE</h2>
                  <h1 className="text-3xl font-extrabold text-gray-800 leading-tight mb-6">
                    ç¥è´ºä½ è¾¾æˆ<br/>
                    <span className="text-red-600">æ–°å¹´ä¸€é©¬å¹³å·</span>
                  </h1>
                  
                  <div className="bg-red-50 rounded-xl p-5 mb-8 border border-red-100">
                    <div className="flex items-center justify-center text-gray-500 mb-2">
                      <Clock size={16} className="mr-2" />
                      <span className="text-xs font-bold uppercase tracking-wide">é€šå…³è€—æ—¶</span>
                    </div>
                    <div className="text-3xl font-mono font-bold text-gray-800">
                      {getDuration()}
                    </div>
                  </div>

                  <div className="space-y-3">
                      <button onClick={() => window.location.reload()} className="w-full py-3.5 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 shadow-lg shadow-red-200 transition-all active:scale-[0.98]">
                         å†ç©ä¸€æ¬¡
                      </button>
                      <div className="flex items-center justify-center text-xs text-gray-400 mt-4 bg-gray-50 py-2 rounded-lg">
                         ğŸ“¸ æˆªå›¾åˆ†äº«ä½ çš„æ–°å¹´å¥½è¿
                      </div>
                  </div>
                </div>
              </div>
              
              <div className="absolute bottom-4 text-white/50 text-xs">
                  Feishu Challenge Â© 2024
              </div>
            </div>
          );

          return (
            <div className="h-full">
              <style>{`
                @keyframes fall {
                  0% { transform: translateY(-10%) rotate(0deg); opacity: 1; }
                  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                }
                .animate-fall {
                  animation-name: fall;
                  animation-timing-function: linear;
                }
                .animate-fade-in-up {
                  animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
                }
                @keyframes fadeInUp {
                  from { opacity: 0; transform: translateY(20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
              `}</style>
              
              {currentScreen === 'welcome' && renderWelcome()}
              {currentScreen === 'map' && renderMap()}
              {currentScreen === 'quiz' && renderQuiz()}
              {currentScreen === 'result' && renderResult()}
            </div>
          );
        }

        // --- æ¸²æŸ“åˆ° DOM ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
